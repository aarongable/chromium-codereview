
<link rel="import" href="cr-action.html">
<link rel="import" href="cr-button.html">
<link rel="import" href="cr-issue-edit-dialog.html">
<link rel="import" href="cr-issue-messages.html">
<link rel="import" href="cr-issue-meta.html">
<link rel="import" href="cr-issue-patchsets.html">
<link rel="import" href="cr-linkified-text.html">
<link rel="import" href="cr-toolbar.html">

<polymer-element name="cr-issue" attributes="issue" cache-csstext>
    <template>
        <link rel="stylesheet" href="common.css">
        <link rel="stylesheet" href="cr-issue.css">

        <template if="{{ issue }}">
            <h1 class="issue-subject">
                Issue <a href="#/issue/{{ issue.id }}">{{ issue.id }}</a><template if="{{ issue.closed }}"> (Closed)</template>: {{ issue.subject }}
            </h1>

            <div class="issue-body">
                <cr-issue-meta issue="{{ issue }}" editing="{{ editing }}"></cr-issue-meta>

                <div class="issue-content">
                    <cr-toolbar class="issue-toolbar">
                        <cr-button on-click="{{ quickLgtm }}">Quick LGTM</cr-button>
                        <cr-button on-click="{{ quickLgtmAndCommit }}">Quick LGTM + CQ</cr-button>
                        <div class="ui-actions">
                            <cr-action on-tap="{{ showEditDialog }}">Edit</cr-action>
                        </div>
                    </cr-toolbar>

                    <div class="issue-description">
                        <cr-linkified-text text="{{ issue.description }}" pre></cr-linkified-text>
                    </div>
                </div>
            </div>

            <h2>Patchsets</h2>
            <cr-issue-patchsets patchsets="{{ issue.patchsets }}"></cr-issue-patchsets>

            <header>
                <h2>Messages</h2>
                <div class="ui-actions">
                    <cr-action on-tap="{{ expandAllMessages }}">Expand All</cr-action> /
                    <cr-action on-tap="{{ collapseAllMessages }}">Collapse All</cr-action>
                </div>
            </header>
            <cr-issue-messages messages="{{ issue.messages }}" id="messages"></cr-issue-messages>
        </template>

        <cr-issue-edit-dialog id="editor" issue="{{ issue }}"></cr-issue-edit-dialog>
    </template>
    <script>
        Polymer("cr-issue", {
            issue: null,
            showEditDialog: function() {
                this.$.editor.showModal();
            },
            collapseAllMessages: function() {
                var messages = this.shadowRoot.getElementById("messages");
                messages.toggleAll({active: false});
            },
            expandAllMessages: function() {
                var messages = this.shadowRoot.getElementById("messages");
                messages.toggleAll({active: true});
                this.async(function() {
                    messages.scrollIntoViewIfNeeded();
                }, null, 350);
            },
            quickLgtm: function() {
                this.fire("quick-lgtm");
            },
            quickLgtmAndCommit: function() {
                this.fire("quick-lgtm-and-commit");
            },
        });
    </script>
</polymer-element>
